# Project Modules & Build System

## Package Modules

### nextjs-blog

Main Next.js blog application with static site generation. Includes calendar-matrix app for interactive calendar visualization and analytics.
**README**: `packages/nextjs-blog/README.md`

### @archieco/image-server

Express-based image processing server using Sharp. Provides CLI tool for serving optimized images during development.
**README**: `packages/image-server/README.md`

### @archieco/static-website-image-gen

CLI tool for generating static website images using JSDOM and Sharp. Automates image creation for blog posts.
**README**: `packages/static-website-image-gen/README.md`

### titlesearch

Command-line utility for searching and managing blog post titles. Built with Commander.js for CLI interactions.
**README**: `packages/titlesearch/README.md`

### unittests

Shared testing utilities and markdown processing tools. Contains unified/remark/rehype pipeline components for content processing.
**README**: `packages/unittests/README.md`

## Calendar Matrix App

Located in `packages/nextjs-blog/src/app/apps/calendar-matrix/`, this interactive calendar application provides:

-   Visual calendar grid with customizable highlighting
-   Analytics tracking for user interactions
-   Usage instructions and feature highlights
-   Client-side calendar builder with controls and tabs

**README**: `packages/nextjs-blog/src/app/apps/calendar-matrix/README.md`

## Build System

### Local Development

```bash
# Setup
nvm use && npm install -g pnpm && pnpm install

# Development workflow
npx nx run nextjs-blog:image-server  # Start image server
npx nx run nextjs-blog:dev           # Start dev server
npx nx run nextjs-blog:test -- --watch  # Run tests
```

### Production Build

GitHub Actions workflow (`.github/workflows/build.yml`) handles deployment:

1. **Build Process**: Uses Nx to run `build` target across all packages
2. **Dependencies**: Installs pnpm, caches node_modules and Nx cache
3. **Workaround**: Creates placeholder files for image-server and static-website-image-gen libs
4. **Output**: Builds Next.js static export to `packages/nextjs-blog/out`
5. **Deploy**: Uploads to GitHub Pages automatically on main branch pushes

### Nx Configuration

-   **Monorepo**: Uses Nx with npm preset for package management
-   **Build Dependencies**: Packages build in dependency order (`^build`)
-   **Caching**: Enabled for build and test operations
-   **Content Integration**: Build inputs include `content/**/*` for blog posts

### Key Build Commands

```bash
npx nx run-many -t build    # Build all packages
npx nx run nextjs-blog:build  # Build blog only
pnpm projen                 # Regenerate project files
```

## Projen Configuration Management

**IMPORTANT**: This project uses Projen for configuration management.

-   **Dependencies**: Add/update dependencies in `.projenrc.ts`, NOT individual package.json files
-   **Regeneration**: Run `pnpm projen` after making changes to `.projenrc.ts`
-   **Generated Files**: Look for `"//": "~~ Generated by projen..."` markers at the bottom of files
-   **DO NOT EDIT**: Files with projen markers will be overwritten - edit `.projenrc.ts` instead
-   **Package.json**: All package.json files are managed by Projen - edit the source configuration instead

### Shadcn/UI Integration with Projen

**CRITICAL**: When using shadcn/ui components, there's a potential conflict with Projen's dependency management:

1. **Shadcn adds dependencies automatically**: Commands like `pnpm dlx shadcn@latest add switch` will modify package.json directly
2. **Projen will overwrite these changes**: Next time you run `pnpm projen`, any dependencies not in `.projenrc.ts` will be removed
3. **Solution**: Always add shadcn dependencies to `.projenrc.ts` BEFORE running shadcn commands

**Workflow for adding shadcn components**:

```bash
# 1. First, add required dependencies to .projenrc.ts
# Example for switch component:
# "@radix-ui/react-switch@latest",
# "class-variance-authority@latest",
# "clsx@latest",
# "tailwind-merge@latest",

# 2. Regenerate project files
pnpm projen

# 3. Now run shadcn command
pnpm dlx shadcn@latest add switch
```

**Common shadcn dependencies to pre-add**:

-   `@radix-ui/react-*` (specific to component)
-   `class-variance-authority@latest`
-   `clsx@latest`
-   `tailwind-merge@latest`
-   `lucide-react@latest` (for icons)

## Additional Resources

-   **Main Setup**: See root `README.md` for complete setup instructions
-   **Package Details**: Each package has its own README (currently placeholder "replace this")
-   **Content**: Blog posts and assets stored in `content/` directory
-   **Configuration**: Projen manages most config files (see `.projenrc.ts`)
